<h1>ИС "Карьер".HTTP API: интеграционный интерфейс. Сопроводительная документация</h1>

**Содержание**:

- [1. HTTP API](#1._http_api)
  - [1.1 Аутентификация](#1.1_аутентификация)
  - [1.2 MIME тип и сжатие данных](#1.2_mime_тип_и_сжатие_данных)
  - [1.3 Коды ответов](#1.3_коды_ответов)
- [2. Методики расчета показателей](#2._методики_расчета_показателей)
  - [2.1 Производственные показатели по добыче и грузоперевозкам руды и вскрыши за сутки](#2.1_производственные_показатели_по_добыче_и_грузоперевозкам_руды_и_вскрыши_за_сутки)
  - [2.2 Производственные показатели по дроблению руды за сутки](#2.2_производственные_показатели_по_дроблению_руды_за_сутки)

# 1. HTTP API

## 1.1 Аутентификация

Аутентификация не предусмотрена, ресурс действует в периметре защиты корпоративной ЛВС.

## 1.2 MIME тип и сжатие данных

MIME тип и кодировка тела ответа:

`Content-Type: application/json; charset=utf-8`

Если клиент поддерживает формат сжатия данных `gzip`, тело ответа более 200 Байт передается в сжатом виде:

`Content-Encoding: gzip`

## 1.3 Коды ответов

Используются стандартные HTTP коды ответов.

При возникновении ошибки на стороне клиента или сервера передается тело ответа вида, пример:

```js
// 500 Internal Server Error

{
  "message": "sql-exception",
  "exception": "java.sql.SQLRecoverableException: Ошибка ввода/вывода: The Network Adapter could not establish the connection",
  "uri": "/api/reports/ore-crushing-results"
}
```

```js
// 400 Bad Request

{
  "spec": "(spec-tools.core/spec {:spec (clojure.spec.alpha/keys :req-un [:spec$38179/date]), :type :map, :leaf? false})",
  "problems": [
    {
      "path": [
        "date"
      ],
      "pred": "(clojure.core/fn [%] (acds-http-api.spec.common/proper-date? %))",
      "val": "45.123.2",
      "via": [
        "spec$38179/date"
      ],
      "in": [
        "date"
      ],
      "reason": "Illegal date format, use DD.MM.YYYY, example 06.01.2021"
    }
  ],
  "type": "reitit.coercion/request-coercion",
  "coercion": "spec",
  "value": {
    "date": "45.123.2"
  },
  "in": [
    "request",
    "query-params"
  ]
}
```

# 2. Методики расчета показателей

## 2.1 Производственные показатели по добыче и грузоперевозкам руды и вскрыши за сутки

**Перечень показателей**:

| Показатель                                          | Передача в ДАС? |
| --------------------------------------------------- | :-------------: |
| 1. Горная масса, тыс. м3:                           |        -        |
| 1.1 Карьер апатит-магнетитовой руды (МАР), тыс. м3  |        +        |
| 1.2 Карьер апатит-штаффелитовой руды (АШР), тыс. м3 |        +        |
| 2. Добыча АМ и АШ руд, тыс. тн:                     |        -        |
| 2.1 Добыча АМ руды, тыс. тн                         |        +        |
| 2.2 Добыча АШ руды, тыс. тн                         |        +        |
| 3. Добыча АМ руды со спецотвалов МЖАР, тыс. тн      |        +        |
| 4. Добыча АШ руды со спецотвала, тыс. тн            |        -        |
| 5. Вскрыша, тыс. м3:                                |        -        |
| 5.1 В контуре карьера МАР, тыс. м3                  |        +        |
| 5.2 В контуре карьера АШР, тыс. м3                  |        +        |
| 6. Коэффициент вскрыши карьера МАР, м3/т            |        -        |
| 7. Коэффициент вскрыши карьера АШР, м3/т            |        -        |

**Методика расчета показателей**:

Целевая система-источник: АСУД ГТК.

Показатели рассчитываются на дату отчета за сутки **с 20:00 по 19:59**.

Определение формул:

- *Горная масса, тыс. м3* (вспомогательный расчет) = Карьер апатит-магнетитовой руды (МАР), тыс.м3 + Карьер апатит-штаффелитовой руды (АШР), тыс.м3, где:
  - **Карьер апатит-магнетитовой руды (МАР), тыс.м3** = Добыча АМ руды, тыс.м3 + В контуре карьера МАР, тыс.м3. + Добыча АМ руды со спецотвалов МЖАР, тыс.м3
  - **Карьер апатит-штаффелитовой руды (АШР), тыс.м3** = Добыча АШ руды, тыс.м3 + В контуре карьера АШР, тыс.м3. + Добыча АШ руды со спецотвала, тыс.м3

- *Добыча АМ и АШ руд, тыс.т* (вспомогательный расчет) = Добыча АМ руды, тыс.т + Добыча АШ руды, тыс.т, где:
  - **Добыча АМ руды, тыс.т** = (∑ Кол-во рейсов автосамосвала по маршруту \* Масса перевезенного груза по маршруту, т) / 1000, где:
    - Масса перевезенного груза, т - учитывается либо средняя масса перевезенного груза по маршруту, либо нормативная масса груза (когда средняя масса = 0).
    - Учитываемые коды видов работ:
        - РДО (Добыча Руды авто).
        - РДСУ (Добыча Руды авто).
        - КАШР (КАШР).
        - КАШФ (КАШФ).
        - ЗБР (Забалансовые руды из карьера).
        - МАРВНБР (Добыча Руды авто).
  - *Добыча АМ руды, тыс.м3* (вспомогательный расчет) = (∑ Кол-во рейсов автосамосвала по маршруту \* Масса перевезенного груза по маршруту, т / Плотность груза, т/м3) / 1000, где:
    - Масса перевезенного груза, т - учитывается либо средняя масса перевезенного груза по маршруту, либо нормативная масса груза (когда средняя масса = 0).
    - Плотность груза, т/м3 = Нормативная масса груза, т / Нормативный объем, м3.
    - Учитываемые коды видов работ:
      - РДО (Добыча Руды авто).
      - РДСУ (Добыча Руды авто).
      - КАШР (КАШР).
      - КАШФ (КАШФ).
      - ЗБР (Забалансовые руды из карьера).
      - МАРВНБР (Добыча Руды авто).
  - **Добыча АШ руды, тыс. т** = (∑ Кол-во рейсов автосамосвала по маршруту \* Масса перевезенного груза по маршруту, т) / 1000, где:
    - Масса перевезенного груза, т - учитывается либо средняя масса перевезенного груза по маршруту, либо нормативная масса груза (когда средняя = 0).
    - Учитываемые коды видов работ:
      - ДАШ (Добыча АШР на склад).
      - ДАШФ (Добыча АШР на фабрику).
  - *Добыча АШ руды, тыс. м3* (вспомогательный расчет) = (∑ Кол-во рейсов автосамосвала по маршруту \* Масса перевезенного груза по маршруту, т / Плотность груза, т/м3) / 1000, где:
    - Масса перевезенного груза, т - учитывается либо средняя масса перевезенного груза по маршруту, либо нормативная масса груза (когда средняя масса = 0).
    - Плотность груза, т/м3 = Нормативная масса груза, т / Нормативный объем, м3.
    - Учитываемые коды видов работ:
      - ДАШ (Добыча АШР на склад).
      - ДАШФ (Добыча АШР на фабрику).

- **Добыча АМ руды со спецотвалов МЖАР, тыс.т** = (∑ Кол-во рейсов автосамосвала по маршруту \* Масса перевезенного груза по маршруту, т) / 1000, где:
  - Масса перевезенного груза, т - учитывается либо средняя масса перевезенного груза по маршруту, либо нормативная масса груза (когда средняя масса = 0).
  - Учитываемые коды видов работ:
    - МЖР4С (МЖР4 на склад).
    - МЖР4Б (МЖР4 на бункер).
- *Добыча АМ руды со спецотвалов МЖАР, тыс.м3* (вспомогательный расчет) = (∑ Кол-во рейсов автосамосвала по маршруту \* Масса перевезенного груза по маршруту, т / Плотность груза, т/м3) / 1000, где:
  - Масса перевезенного груза, т - учитывается либо средняя масса перевезенного груза по маршруту, либо нормативная масса груза (когда средняя масса = 0).
  - Плотность груза, т/м3 = Нормативная масса груза, т / Нормативный объем, м3.
  - Учитываемые коды видов работ:
    - МЖР4С (МЖР4 на склад).
    - МЖР4Б (МЖР4 на бункер).
- *Добыча АШ руды со спецотвала, тыс.т* (вспомогательный расчет) = (∑ Кол-во рейсов автосамосвала по маршруту \* Масса перевезенного груза по маршруту, т) / 1000, где:
  - Масса перевезенного груза, т - учитывается либо средняя масса перевезенного груза по маршруту, либо нормативная масса груза (когда средняя масса = 0).
  - Учитываемые коды видов работ:
    - ДАШСОС (Добыча АШР со спец.отв. на склад).
    - ДАШСОФ (Добыча АШР со спец.отв. на фабрику).
- *Добыча АШ руды со спецотвала, тыс.м3* (вспомогательный расчет) = (∑ Кол-во рейсов автосамосвала по маршруту \* Масса перевезенного груза по маршруту, т / Плотность груза, т/м3) / 1000, где:
  - Масса перевезенного груза, т - учитывается либо средняя масса перевезенного груза по маршруту, либо нормативная масса груза (когда средняя масса = 0).
  - Плотность груза, т/м3 = Нормативная масса груза, т / Нормативный объем, м3.
  - Учитываемые коды видов работ:
    - ДАШСОС (Добыча АШР со спец.отв. на склад).
    - ДАШСОФ (Добыча АШР со спец.отв. на фабрику).

- *Вскрыша, тыс. м3* (вспомогательный расчет) = В контуре карьера МАР, тыс.м3 + В контуре карьера АШР, тыс.м3, где:
  - **В контуре карьера МАР, тыс.м3** = (∑ Кол-во рейсов автосамосвала по маршруту \* Масса перевезенного груза по маршруту, т / Плотность груза, т/м3) / 1000, где:
    - Масса перевезенного груза, т - учитывается либо средняя масса перевезенного груза по маршруту, либо нормативная масса груза (когда средняя = 0).
    - Плотность груза, т/м3 = Нормативная масса груза, т / Нормативный объем, м3.
    - Учитываемые коды видов работ:
      - ВСК (Вскрыша авто).
      - ВНД (Вскрыша авто).
      - ДСУ (Вскрыша авто).
      - ВСД (Нет соответствия вида работ для сменного задания).
      - СЗР (Вскрыша авто).
      - ВИП (Нет соответствия вида работ для сменного задания).
      - ВВО1 (Вторичная вскрыша 1 отвала).
      - ИПДСУ (Инвест проект ДСУ).
      - ВДСК (Вскрыша авто)
  - **В контуре карьера АШР, тыс. м3** = (∑ Кол-во рейсов автосамосвала по маршруту \* Масса перевезенного груза по маршруту, т / Плотность груза, т/м3) / 1000, где:
    - Масса перевезенного груза, т - учитывается либо средняя масса перевезенного груза по маршруту, либо нормативная масса груза (когда средняя = 0).
    - Плотность груза, т/м3 = Нормативная масса груза, т / Нормативный объем, м3.
    - Учитываемые коды видов работ:
      - АШРКВ (Вскрыша с АШР карьера).
      - АШРКВД (Вскрыша с АШР карьера).
      - АРМО (Вскрыша АШР с разноса МАР).
      - АРМД (Вскрыша АШР с разноса МАР).

- *Коэффициент вскрыши карьера МАР, м3/т* (вспомогательный расчет) = В контуре карьера МАР, тыс.м3 / Добыча АМ руды, тыс.т.
- *Коэффициент вскрыши карьера АШР, м3/т* (вспомогательный расчет) = В контуре карьера АШР, тыс.м3 / Добыча АШ руды, тыс.т.

## 2.2 Производственные показатели по дроблению руды за сутки

**Перечень показателей**:

| Показатель                                       | Передача в ДАС? |
| ------------------------------------------------ | :-------------: |
| 1. Дробление АМ руды (Конвейер №7), тыс. тн.     |        +        |
| 2. Дробление АШ руды, тыс. тн.                   |        -        |
| 3. Конвейер №-15, тыс. тн.                       |        +        |
| 4. Конвейер УС-1, тыс. тн.                       |        +        |
| 5. Конвейер УС-4, тыс. тн.                       |        +        |

**Методика расчета показателей**:

Целевая система-источник: АСУ ПТС, АСУТП УСМДР, АСУТП ПАШР.

Показатели рассчитываются на дату отчета за сутки **с 00:00 по 23:59**.

Определение формул:

- **Дробление АМ руды (Конвейер №7), тыс.т** = (∑ Показания весов за час, т) / 1000, где:
  - Учитываемые метки конвейеров:
    - 01DF.CV07.WT01

- **Дробление АШ руды, тыс. т** = формула расчета неизвестна.

- **Конвейер №-15, тыс.т** = (∑ Показания весов за час, т) / 1000, где:
  - Учитываемые метки конвейеров:
    - 01DF.CV15.WT01

- **Конвейер УС-1, тыс.т** = (∑ Показания весов за час, т) / 1000, где:
  - Учитываемые метки конвейеров:
    - 02US.CV01.WT01

- **Конвейер УС-4, тыс.т** = (∑ Показания весов за час, т) / 1000, где:
  - Учитываемые метки конвейеров:
    - 02US.CV04.WT01
